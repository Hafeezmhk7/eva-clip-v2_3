2025-08-01 00:42:26,157 - INFO - üîß FIXED: CLIP Reproduction Training with PROPER NOISE SCALING
2025-08-01 00:42:26,158 - INFO - ==========================================================================================
2025-08-01 00:42:26,158 - INFO - üîß KEY FIXES APPLIED:
2025-08-01 00:42:26,158 - INFO -   ‚úÖ Proper noise scaling to match CLIP embedding distribution
2025-08-01 00:42:26,158 - INFO -   ‚úÖ Enhanced scale monitoring and debugging
2025-08-01 00:42:26,158 - INFO -   ‚úÖ Diverse overfitting test with multiple samples
2025-08-01 00:42:26,158 - INFO -   ‚úÖ Norm ratio tracking and validation
2025-08-01 00:42:26,158 - INFO -   ‚úÖ Automatic scale detection and adaptation
2025-08-01 00:42:26,158 - INFO -   ‚úÖ Comprehensive scale statistics and analysis
2025-08-01 00:42:26,158 - INFO - ==========================================================================================
2025-08-01 00:42:26,158 - INFO - EXPERIMENT DETAILS:
2025-08-01 00:42:26,158 - INFO -   üìã Task: Reproduce clean CLIP embeddings from EVA embeddings
2025-08-01 00:42:26,158 - INFO -   üß† Model: FIXED BLIP3-o DiT with proper generation scaling
2025-08-01 00:42:26,158 - INFO -   üéØ Target: CLIP embeddings [B, N, 1024] - RAW scale preserved
2025-08-01 00:42:26,158 - INFO -   üéÆ Conditioning: EVA embeddings [B, N, 4096] - RAW scale preserved
2025-08-01 00:42:26,158 - INFO -   üåä Method: Rectified Flow Matching with proper noise scaling
2025-08-01 00:42:26,158 - INFO -   üîß Noise Scaling: Match CLIP embedding distribution
2025-08-01 00:42:26,158 - INFO -   üìä Monitoring: Enhanced scale tracking and debugging
2025-08-01 00:42:26,158 - INFO - ==========================================================================================
2025-08-01 00:42:26,159 - INFO - Configuration:
2025-08-01 00:42:26,159 - INFO -   Model size: base
2025-08-01 00:42:26,159 - INFO -   Training mode: patch_only
2025-08-01 00:42:26,159 - INFO -   Embeddings dir: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 00:42:26,159 - INFO -   Output dir: ./checkpoints/clip_repro_20250801_004223
2025-08-01 00:42:26,159 - INFO -   Learning rate: 0.0005
2025-08-01 00:42:26,159 - INFO -   Batch size: 8
2025-08-01 00:42:26,159 - INFO -   Epochs: 10
2025-08-01 00:42:26,159 - INFO -   Max shards: 2
2025-08-01 00:42:26,159 - INFO -   üîß Adaptive noise scaling: True
2025-08-01 00:42:26,159 - INFO -   Fixed noise scale: 25.0
2025-08-01 00:42:26,159 - INFO -   Mixed precision: True
2025-08-01 00:42:26,159 - INFO -   üß™ DIVERSE OVERFITTING TEST: 20 samples
2025-08-01 00:42:26,159 - INFO -   Debug mode: False
2025-08-01 00:42:26,159 - INFO - ==========================================================================================
2025-08-01 00:42:26,159 - INFO - üîç Validating embeddings for scale issues...
2025-08-01 00:42:26,160 - INFO - Checking sample file: embeddings_shard_00027_patch_only.pkl
2025-08-01 00:42:31,305 - INFO - Embedding validation results:
2025-08-01 00:42:31,305 - INFO -   CLIP embeddings:
2025-08-01 00:42:31,305 - INFO -     Shape: torch.Size([2588, 256, 1024])
2025-08-01 00:42:31,305 - INFO -     Norm (mean): 26.354
2025-08-01 00:42:31,305 - INFO -     Std: 0.979
2025-08-01 00:42:31,305 - INFO -     Mean: 0.024
2025-08-01 00:42:31,324 - INFO -     Min: -38.375
2025-08-01 00:42:31,342 - INFO -     Max: 226.875
2025-08-01 00:42:31,343 - INFO -   EVA embeddings:
2025-08-01 00:42:31,343 - INFO -     Shape: torch.Size([2588, 256, 4096])
2025-08-01 00:42:31,343 - INFO -     Norm (mean): 43.690
2025-08-01 00:42:31,343 - WARNING - ‚ö†Ô∏è  Potential embedding scale issues detected:
2025-08-01 00:42:31,343 - WARNING -     ‚Ä¢ CLIP embeddings appear to be zero-centered
2025-08-01 00:42:31,343 - WARNING -     These issues might affect noise scaling and training.
2025-08-01 00:42:31,793 - INFO - Using GPU: NVIDIA H100
2025-08-01 00:42:31,793 - INFO - GPU Memory: 100.0 GB
2025-08-01 00:42:31,793 - INFO - üèóÔ∏è FIXED BLIP3-o Architecture Configuration:
2025-08-01 00:42:31,793 - INFO -   3D Rotary Position Embedding: ‚úÖ Enabled
2025-08-01 00:42:31,794 - INFO -   Sandwich Normalization: ‚úÖ Enabled
2025-08-01 00:42:31,794 - INFO -   üîß FIXED: Proper generation scaling enabled
2025-08-01 00:42:37,449 - INFO - ‚úÖ CLIP DiT model loaded from src/modules/models/blip3o_dit.py
2025-08-01 00:42:37,453 - INFO - ‚úÖ Flow matching loss loaded from src/modules/losses/blip3o_fm_loss.py
2025-08-01 00:42:38,686 - INFO - ‚úÖ CLIP trainer loaded from src/modules/trainers/blip3o_trainer.py
2025-08-01 00:42:38,698 - INFO - ‚úÖ CLIP datasets loaded from src/modules/datasets/blip3o_dataset.py
2025-08-01 00:42:38,702 - INFO - ‚úÖ Configuration loaded from src/modules/config/blip3o_config.py
2025-08-01 00:42:38,702 - INFO - üéâ All CLIP reproduction components loaded successfully!
2025-08-01 00:42:38,702 - INFO - üéâ BLIP3-o CLIP reproduction modules fully initialized!
2025-08-01 00:42:38,702 - INFO - üö´ Using minimal normalization approach
2025-08-01 00:42:38,702 - INFO - üéØ Ready for EVA ‚Üí CLIP reproduction training
2025-08-01 00:42:38,703 - INFO - ‚úÖ Imported FIXED model
2025-08-01 00:42:40,721 - INFO - FIXED BLIP3-o CLIP DiT model initialized with 249,339,136 parameters
2025-08-01 00:42:40,721 - INFO -   3D RoPE: True
2025-08-01 00:42:40,721 - INFO -   Sandwich Normalization: True
2025-08-01 00:42:40,721 - INFO -   Grid size: 16x16
2025-08-01 00:42:40,721 - INFO -   Hidden size: 768
2025-08-01 00:42:40,721 - INFO -   CLIP size: 1024
2025-08-01 00:42:40,721 - INFO -   üîß FIXED: Proper generation scaling enabled
2025-08-01 00:42:40,937 - INFO - FIXED model created with 249,339,136 parameters
2025-08-01 00:42:40,937 - INFO - Model moved to cuda
2025-08-01 00:42:40,937 - INFO - ‚úÖ Imported FIXED loss function
2025-08-01 00:42:40,937 - INFO - FIXED CLIP Flow Matching Loss initialized:
2025-08-01 00:42:40,937 - INFO -   Prediction type: velocity
2025-08-01 00:42:40,937 - INFO -   Flow type: rectified
2025-08-01 00:42:40,937 - INFO -   Adaptive noise scaling: True
2025-08-01 00:42:40,937 - INFO -   Initial noise scale: 25.0
2025-08-01 00:42:40,937 - INFO -   üîß FIXED: Automatic scale detection enabled
2025-08-01 00:42:40,937 - INFO -   Debug mode: False
2025-08-01 00:42:40,937 - INFO - FIXED loss function created:
2025-08-01 00:42:40,937 - INFO -   Adaptive noise scaling: True
2025-08-01 00:42:40,937 - INFO -   Fixed noise scale: 25.0
2025-08-01 00:42:40,937 - INFO -   üîß FIXED: Proper noise scaling to match CLIP distribution
2025-08-01 00:42:40,937 - INFO - ‚úÖ Imported FIXED dataset
2025-08-01 00:42:40,938 - INFO - FIXED: Creating CLIP reproduction dataloaders:
2025-08-01 00:42:40,938 - INFO -   Target: CLIP embeddings [B, N, 1024] - RAW (no normalization)
2025-08-01 00:42:40,938 - INFO -   Conditioning: EVA embeddings [B, N, 4096] - RAW (no normalization)
2025-08-01 00:42:40,938 - INFO -   üö´ Normalization: DISABLED (forced)
2025-08-01 00:42:40,938 - INFO -   Collect statistics: True
2025-08-01 00:42:41,000 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-01 00:42:41,001 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-01 00:42:41,023 - INFO - Prepared 2 shard files
2025-08-01 00:42:41,023 - INFO - Using manifest for length estimation: 5,219 samples
2025-08-01 00:42:41,023 - INFO - FIXED CLIP Reproduction Dataset initialized:
2025-08-01 00:42:41,023 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 00:42:41,023 - INFO -   Mode: patch_only (256 tokens)
2025-08-01 00:42:41,023 - INFO -   TARGET: CLIP embeddings [B, N, 1024] - RAW (no normalization)
2025-08-01 00:42:41,023 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096] - RAW (no normalization)
2025-08-01 00:42:41,023 - INFO -   üö´ Normalization: DISABLED (raw embedding space)
2025-08-01 00:42:41,023 - INFO -   Shards: 2
2025-08-01 00:42:41,023 - INFO -   Statistics collection: False
2025-08-01 00:42:41,023 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-01 00:42:41,023 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-01 00:42:41,024 - INFO - Prepared 2 shard files
2025-08-01 00:42:41,024 - INFO - Using manifest for length estimation: 5,219 samples
2025-08-01 00:42:41,024 - INFO - FIXED CLIP Reproduction Dataset initialized:
2025-08-01 00:42:41,024 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 00:42:41,024 - INFO -   Mode: patch_only (256 tokens)
2025-08-01 00:42:41,024 - INFO -   TARGET: CLIP embeddings [B, N, 1024] - RAW (no normalization)
2025-08-01 00:42:41,024 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096] - RAW (no normalization)
2025-08-01 00:42:41,024 - INFO -   üö´ Normalization: DISABLED (raw embedding space)
2025-08-01 00:42:41,024 - INFO -   Shards: 2
2025-08-01 00:42:41,024 - INFO -   Statistics collection: False
2025-08-01 00:42:41,024 - INFO - FIXED: CLIP reproduction dataloaders created successfully
2025-08-01 00:42:41,024 - INFO -   Training dataset length: 5,219
2025-08-01 00:42:41,024 - INFO -   Evaluation dataset length: 5,219
2025-08-01 00:42:41,024 - INFO -   üö´ NO normalization applied in either dataset
2025-08-01 00:42:41,024 - INFO -   Consistent processing: ‚úÖ
2025-08-01 00:42:41,024 - INFO - FIXED dataloaders created:
2025-08-01 00:42:41,024 - INFO -   üîß FIXED: Proper noise scaling enabled
2025-08-01 00:42:41,024 - INFO -   Statistics collection: Enabled
2025-08-01 00:42:41,024 - INFO -   Max shards: 2
2025-08-01 00:42:41,024 - INFO -   Enhanced scale monitoring: ‚úÖ
2025-08-01 00:42:41,024 - INFO - ‚úÖ Imported FIXED trainer
2025-08-01 00:42:41,027 - INFO - Got exact dataloader length: 652
2025-08-01 00:42:41,029 - INFO - Optimizer and scheduler setup complete
2025-08-01 00:42:41,029 - INFO -   Total estimated steps: 6520
2025-08-01 00:42:41,029 - INFO -   Warmup steps: 100
2025-08-01 00:42:41,029 - INFO - Preparing reference batch for consistent evaluation...
2025-08-01 00:42:46,292 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 00:42:46,333 - INFO - Reference batch prepared:
2025-08-01 00:42:46,333 - INFO -   CLIP norm: 25.292
2025-08-01 00:42:46,333 - INFO -   CLIP std: 0.941
2025-08-01 00:42:46,333 - INFO -   CLIP mean: 0.023
2025-08-01 00:42:46,333 - INFO -   EVA norm: 42.896
2025-08-01 00:42:46,333 - INFO -   Samples: 4
2025-08-01 00:42:46,333 - INFO - üîß FIXED: Preparing diverse overfitting test with 20 samples...
2025-08-01 00:42:46,333 - INFO - Using eval_dataloader for diverse overfitting test
2025-08-01 00:42:50,549 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 00:42:50,648 - INFO - ‚úÖ FIXED diverse overfitting test prepared with 20 samples:
2025-08-01 00:42:50,648 - INFO -   Data source: eval_dataloader
2025-08-01 00:42:50,648 - INFO -   CLIP norm: 25.894 ¬± 1.330
2025-08-01 00:42:50,648 - INFO -   EVA norm: 43.451 ¬± 2.407
2025-08-01 00:42:50,649 - INFO -   Diversity: CLIP range [23.936, 29.956]
2025-08-01 00:42:50,649 - INFO - FIXED BLIP3-o CLIP Trainer initialized
2025-08-01 00:42:50,649 - INFO -   Device: cuda
2025-08-01 00:42:50,649 - INFO -   Learning rate: 0.0005
2025-08-01 00:42:50,649 - INFO -   Epochs: 10
2025-08-01 00:42:50,649 - INFO -   Estimated steps per epoch: 652
2025-08-01 00:42:50,649 - INFO -   Overfit test: 20
2025-08-01 00:42:50,649 - INFO -   Mixed precision: True
2025-08-01 00:42:50,649 - INFO -   WandB logging: False
2025-08-01 00:42:50,649 - INFO -   üîß FIXED: Enhanced scale monitoring enabled
2025-08-01 00:42:50,649 - INFO - FIXED trainer created:
2025-08-01 00:42:50,649 - INFO -   Evaluation: Every 50 steps
2025-08-01 00:42:50,649 - INFO -   Inference steps: 20
2025-08-01 00:42:50,649 - INFO -   Mixed precision: True
2025-08-01 00:42:50,649 - INFO -   WandB enabled: False
2025-08-01 00:42:50,649 - INFO -   üîß FIXED: Enhanced scale monitoring enabled
2025-08-01 00:42:50,649 - INFO -   Diverse overfit test: 20 samples
2025-08-01 00:42:50,649 - INFO - üî¨ SCALE DEBUGGING TIPS:
2025-08-01 00:42:50,649 - INFO - ============================================================
2025-08-01 00:42:50,649 - INFO - During training, monitor these metrics:
2025-08-01 00:42:50,649 - INFO -   ‚Ä¢ 'PredRatio' should be close to 1.0 (¬±0.2)
2025-08-01 00:42:50,649 - INFO -   ‚Ä¢ 'NoiseRatio' should be close to 1.0 (¬±0.2)
2025-08-01 00:42:50,649 - INFO -   ‚Ä¢ 'Scale=‚úÖ' indicates good scale consistency
2025-08-01 00:42:50,649 - INFO -   ‚Ä¢ Velocity similarity should increase steadily
2025-08-01 00:42:50,649 - INFO - 
2025-08-01 00:42:50,649 - INFO - If you see scale issues:
2025-08-01 00:42:50,649 - INFO -   ‚Ä¢ PredRatio >> 1.0: Model generates too large embeddings
2025-08-01 00:42:50,649 - INFO -   ‚Ä¢ PredRatio << 1.0: Model generates too small embeddings
2025-08-01 00:42:50,649 - INFO -   ‚Ä¢ NoiseRatio != 1.0: Noise scaling mismatch
2025-08-01 00:42:50,650 - INFO -   ‚Ä¢ Scale=‚ö†Ô∏è: Inconsistent scaling detected
2025-08-01 00:42:50,650 - INFO - 
2025-08-01 00:42:50,650 - INFO - Fixes for common issues:
2025-08-01 00:42:50,650 - INFO -   ‚Ä¢ Use --use_adaptive_noise_scaling for automatic scale detection
2025-08-01 00:42:50,650 - INFO -   ‚Ä¢ Adjust --fixed_noise_scale to match your CLIP embedding norms
2025-08-01 00:42:50,650 - INFO -   ‚Ä¢ Check embedding validation results above
2025-08-01 00:42:50,650 - INFO -   ‚Ä¢ Monitor WandB for detailed scale tracking
2025-08-01 00:42:50,650 - INFO - ============================================================
2025-08-01 00:42:50,652 - INFO - FIXED configuration saved to checkpoints/clip_repro_20250801_004223/fixed_scale_experiment_config.json
2025-08-01 00:42:50,652 - INFO - 
üîß Starting FIXED BLIP3-o training with proper noise scaling...
2025-08-01 00:42:50,652 - INFO - Expected behavior with FIXED SCALE HANDLING:
2025-08-01 00:42:50,652 - INFO -   ‚Ä¢ Noise scale matches CLIP embedding distribution (~25 for typical CLIP)
2025-08-01 00:42:50,652 - INFO -   ‚Ä¢ Pred/CLIP ratio stays close to 1.0 (¬±0.2)
2025-08-01 00:42:50,652 - INFO -   ‚Ä¢ Noise/CLIP ratio stays close to 1.0 (¬±0.2)
2025-08-01 00:42:50,652 - INFO -   ‚Ä¢ Scale consistency indicators show ‚úÖ throughout training
2025-08-01 00:42:50,652 - INFO -   ‚Ä¢ Velocity similarity increases steadily and reaches >0.8
2025-08-01 00:42:50,652 - INFO -   ‚Ä¢ Generated embeddings have similar norms to target embeddings
2025-08-01 00:42:50,652 - INFO -   ‚Ä¢ Enhanced monitoring catches and reports scale issues
2025-08-01 00:42:50,652 - INFO -   ‚Ä¢ DIVERSE OVERFITTING TEST: Should achieve >0.8 similarity on 20 diverse samples
2025-08-01 00:42:50,652 - INFO -     ‚úÖ Uses diverse samples from multiple batches for robust validation
2025-08-01 00:42:50,652 - INFO - 
2025-08-01 00:42:50,652 - INFO - üîß FIXED: Starting CLIP reproduction training with enhanced scale monitoring...
2025-08-01 00:42:50,653 - INFO -   Model parameters: 249,339,136
2025-08-01 00:42:50,653 - INFO -   Estimated training steps per epoch: 652
2025-08-01 00:42:50,653 - INFO -   Total estimated training steps: 6520
2025-08-01 00:42:50,653 - INFO -   üìä WandB logging: False
2025-08-01 00:42:50,653 - INFO -   üîß FIXED: Enhanced scale monitoring enabled
2025-08-01 00:42:50,653 - INFO -   DIVERSE OVERFITTING TEST: Using 20 diverse samples
2025-08-01 00:42:50,655 - INFO - Starting epoch 1/10
2025-08-01 00:42:55,455 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:42:58,808 - INFO - Step 10: Loss=1.651435, VelSim=0.3471 (fair), GradNorm=19648.257, LR=9.50e-05, PredRatio=0.472, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:01,645 - INFO - Step 20: Loss=1.617603, VelSim=0.3582 (fair), GradNorm=165613.543, LR=1.40e-04, PredRatio=0.616, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:04,483 - INFO - Step 30: Loss=1.555883, VelSim=0.3913 (fair), GradNorm=11523.418, LR=1.85e-04, PredRatio=0.612, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:07,321 - INFO - Step 40: Loss=1.482649, VelSim=0.4095 (fair), GradNorm=14628.018, LR=2.30e-04, PredRatio=0.623, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:10,159 - INFO - Step 50: Loss=1.390264, VelSim=0.4038 (fair), GradNorm=37103.541, LR=2.75e-04, PredRatio=0.675, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:10,159 - INFO - üìä SCALE ANALYSIS:
2025-08-01 00:43:10,160 - INFO -   Training CLIP norms: mean=25.894, std=0.000
2025-08-01 00:43:10,160 - INFO -   Training pred norms: mean=15.409, std=1.948
2025-08-01 00:43:10,160 - INFO -   Pred/CLIP ratios: mean=0.595, deviation=0.405
2025-08-01 00:43:10,160 - WARNING -     ‚ö†Ô∏è  Poor scale consistency - needs attention
2025-08-01 00:43:10,160 - INFO -   Scale quality: 100.0% good steps (excellent)
2025-08-01 00:43:10,160 - INFO - Running FIXED evaluation at step 50...
2025-08-01 00:43:15,201 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 00:43:29,643 - INFO - FIXED Evaluation results:
2025-08-01 00:43:29,644 - INFO -   CLIP similarity: 0.0098
2025-08-01 00:43:29,644 - INFO -   Generated norm: 809.474
2025-08-01 00:43:29,644 - INFO -   Target norm: 25.856
2025-08-01 00:43:29,644 - INFO -   Norm ratio: 31.307
2025-08-01 00:43:29,644 - INFO -   Scale consistency: -29.307
2025-08-01 00:43:29,644 - INFO -   Scale quality: ‚ö†Ô∏è Needs work
2025-08-01 00:43:32,490 - INFO - Step 60: Loss=1.289048, VelSim=0.4078 (fair), GradNorm=49415.397, LR=3.20e-04, PredRatio=0.708, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:35,311 - INFO - Step 70: Loss=1.288037, VelSim=0.3978 (fair), GradNorm=65284.935, LR=3.65e-04, PredRatio=0.720, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:38,108 - INFO - Step 80: Loss=1.220212, VelSim=0.4483 (fair), GradNorm=34392.036, LR=4.10e-04, PredRatio=0.796, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:40,912 - INFO - Step 90: Loss=1.166282, VelSim=0.4787 (fair), GradNorm=20894.267, LR=4.55e-04, PredRatio=0.772, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:43,711 - INFO - Step 100: Loss=1.172231, VelSim=0.4812 (fair), GradNorm=33698.884, LR=5.00e-04, PredRatio=0.816, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:43:43,712 - INFO - üìä SCALE ANALYSIS:
2025-08-01 00:43:43,712 - INFO -   Training CLIP norms: mean=25.894, std=0.000
2025-08-01 00:43:43,712 - INFO -   Training pred norms: mean=17.490, std=2.638
2025-08-01 00:43:43,712 - INFO -   Pred/CLIP ratios: mean=0.675, deviation=0.325
2025-08-01 00:43:43,712 - WARNING -     ‚ö†Ô∏è  Poor scale consistency - needs attention
2025-08-01 00:43:43,712 - INFO -   Scale quality: 100.0% good steps (excellent)
2025-08-01 00:43:43,712 - INFO - Running FIXED evaluation at step 100...
2025-08-01 00:43:48,458 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 00:44:02,754 - INFO - FIXED Evaluation results:
2025-08-01 00:44:02,754 - INFO -   CLIP similarity: 0.0108
2025-08-01 00:44:02,754 - INFO -   Generated norm: 809.005
2025-08-01 00:44:02,754 - INFO -   Target norm: 25.856
2025-08-01 00:44:02,754 - INFO -   Norm ratio: 31.289
2025-08-01 00:44:02,754 - INFO -   Scale consistency: -29.289
2025-08-01 00:44:02,754 - INFO -   Scale quality: ‚ö†Ô∏è Needs work
2025-08-01 00:44:05,550 - INFO - Step 110: Loss=1.035746, VelSim=0.5579 (good), GradNorm=16539.523, LR=5.00e-04, PredRatio=0.916, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:44:08,342 - INFO - Step 120: Loss=0.901638, VelSim=0.6320 (good), GradNorm=30617.928, LR=5.00e-04, PredRatio=1.023, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:44:11,133 - INFO - Step 130: Loss=0.747601, VelSim=0.7099 (good), GradNorm=34795.345, LR=5.00e-04, PredRatio=1.163, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:44:13,935 - INFO - Step 140: Loss=0.618587, VelSim=0.7690 (good), GradNorm=46941.745, LR=5.00e-04, PredRatio=1.224, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:44:16,881 - INFO - Step 150: Loss=0.487455, VelSim=0.8254 (excellent), GradNorm=27320.484, LR=5.00e-04, PredRatio=1.297, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:44:16,884 - INFO - üìä SCALE ANALYSIS:
2025-08-01 00:44:16,884 - INFO -   Training CLIP norms: mean=25.894, std=0.000
2025-08-01 00:44:16,884 - INFO -   Training pred norms: mean=20.930, std=5.815
2025-08-01 00:44:16,884 - INFO -   Pred/CLIP ratios: mean=0.808, deviation=0.192
2025-08-01 00:44:16,884 - INFO -     ‚úÖ Good scale consistency
2025-08-01 00:44:16,885 - INFO -   Scale quality: 100.0% good steps (excellent)
2025-08-01 00:44:16,885 - INFO - Running FIXED evaluation at step 150...
2025-08-01 00:44:21,648 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 00:44:35,951 - INFO - FIXED Evaluation results:
2025-08-01 00:44:35,953 - INFO -   CLIP similarity: 0.0090
2025-08-01 00:44:35,953 - INFO -   Generated norm: 808.544
2025-08-01 00:44:35,953 - INFO -   Target norm: 25.856
2025-08-01 00:44:35,953 - INFO -   Norm ratio: 31.271
2025-08-01 00:44:35,953 - INFO -   Scale consistency: -29.271
2025-08-01 00:44:35,953 - INFO -   Scale quality: ‚ö†Ô∏è Needs work
2025-08-01 00:44:38,750 - INFO - Step 160: Loss=0.380261, VelSim=0.8673 (excellent), GradNorm=19540.053, LR=5.00e-04, PredRatio=1.367, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:44:41,555 - INFO - Step 170: Loss=0.325733, VelSim=0.8879 (excellent), GradNorm=32034.749, LR=5.00e-04, PredRatio=1.400, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:44:43,510 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:44:43,510 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:44:43,510 - INFO - Epoch 1 completed:
2025-08-01 00:44:43,510 - INFO -   Average loss: 1.089041
2025-08-01 00:44:43,510 - INFO -   Best loss: 0.288000
2025-08-01 00:44:43,510 - INFO -   Best similarity: 0.9017
2025-08-01 00:44:43,510 - INFO -   Steps in epoch: 177
2025-08-01 00:44:43,510 - INFO -   Epoch time: 112.9s
2025-08-01 00:44:43,511 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:44:43,511 - INFO -     Pred/CLIP ratio: 0.897 ¬± 0.294
2025-08-01 00:44:43,511 - INFO -     Deviation from ideal (1.0): 0.103
2025-08-01 00:44:43,511 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:44:43,511 - INFO - Starting epoch 2/10
2025-08-01 00:44:48,079 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:44:48,359 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:44:48,360 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:44:48,360 - INFO - Epoch 2 completed:
2025-08-01 00:44:48,360 - INFO -   Average loss: 0.284479
2025-08-01 00:44:48,360 - INFO -   Best loss: 0.284479
2025-08-01 00:44:48,360 - INFO -   Best similarity: 0.9029
2025-08-01 00:44:48,360 - INFO -   Steps in epoch: 1
2025-08-01 00:44:48,360 - INFO -   Epoch time: 4.8s
2025-08-01 00:44:48,360 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:44:48,360 - INFO -     Pred/CLIP ratio: 0.900 ¬± 0.296
2025-08-01 00:44:48,361 - INFO -     Deviation from ideal (1.0): 0.100
2025-08-01 00:44:48,361 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:44:48,361 - INFO - Starting epoch 3/10
2025-08-01 00:44:52,591 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:44:52,872 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:44:52,872 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:44:52,872 - INFO - Epoch 3 completed:
2025-08-01 00:44:52,872 - INFO -   Average loss: 0.280286
2025-08-01 00:44:52,872 - INFO -   Best loss: 0.280286
2025-08-01 00:44:52,872 - INFO -   Best similarity: 0.9045
2025-08-01 00:44:52,872 - INFO -   Steps in epoch: 1
2025-08-01 00:44:52,872 - INFO -   Epoch time: 4.5s
2025-08-01 00:44:52,873 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:44:52,873 - INFO -     Pred/CLIP ratio: 0.903 ¬± 0.298
2025-08-01 00:44:52,873 - INFO -     Deviation from ideal (1.0): 0.097
2025-08-01 00:44:52,873 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:44:52,873 - INFO - Starting epoch 4/10
2025-08-01 00:44:56,916 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:44:57,203 - INFO - Step 180: Loss=0.276116, VelSim=0.9058 (excellent), GradNorm=25058.675, LR=5.00e-04, PredRatio=1.442, NoiseRatio=1.196, Scale=‚úÖ [OVERFIT TEST]
2025-08-01 00:44:57,204 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:44:57,204 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:44:57,204 - INFO - Epoch 4 completed:
2025-08-01 00:44:57,204 - INFO -   Average loss: 0.276116
2025-08-01 00:44:57,204 - INFO -   Best loss: 0.276116
2025-08-01 00:44:57,204 - INFO -   Best similarity: 0.9058
2025-08-01 00:44:57,204 - INFO -   Steps in epoch: 1
2025-08-01 00:44:57,204 - INFO -   Epoch time: 4.3s
2025-08-01 00:44:57,204 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:44:57,204 - INFO -     Pred/CLIP ratio: 0.906 ¬± 0.299
2025-08-01 00:44:57,204 - INFO -     Deviation from ideal (1.0): 0.094
2025-08-01 00:44:57,204 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:44:57,205 - INFO - Starting epoch 5/10
2025-08-01 00:45:01,353 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:45:01,640 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:45:01,640 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:45:01,640 - INFO - Epoch 5 completed:
2025-08-01 00:45:01,640 - INFO -   Average loss: 0.272425
2025-08-01 00:45:01,640 - INFO -   Best loss: 0.272425
2025-08-01 00:45:01,640 - INFO -   Best similarity: 0.9072
2025-08-01 00:45:01,640 - INFO -   Steps in epoch: 1
2025-08-01 00:45:01,640 - INFO -   Epoch time: 4.4s
2025-08-01 00:45:01,641 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:45:01,641 - INFO -     Pred/CLIP ratio: 0.909 ¬± 0.301
2025-08-01 00:45:01,641 - INFO -     Deviation from ideal (1.0): 0.091
2025-08-01 00:45:01,641 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:45:01,641 - INFO - Starting epoch 6/10
2025-08-01 00:45:05,746 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:45:06,030 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:45:06,030 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:45:06,030 - INFO - Epoch 6 completed:
2025-08-01 00:45:06,031 - INFO -   Average loss: 0.269360
2025-08-01 00:45:06,031 - INFO -   Best loss: 0.269360
2025-08-01 00:45:06,031 - INFO -   Best similarity: 0.9084
2025-08-01 00:45:06,031 - INFO -   Steps in epoch: 1
2025-08-01 00:45:06,031 - INFO -   Epoch time: 4.4s
2025-08-01 00:45:06,031 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:45:06,031 - INFO -     Pred/CLIP ratio: 0.912 ¬± 0.303
2025-08-01 00:45:06,031 - INFO -     Deviation from ideal (1.0): 0.088
2025-08-01 00:45:06,031 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:45:06,031 - INFO - Starting epoch 7/10
2025-08-01 00:45:10,028 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:45:10,307 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:45:10,307 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:45:10,307 - INFO - Epoch 7 completed:
2025-08-01 00:45:10,307 - INFO -   Average loss: 0.266205
2025-08-01 00:45:10,307 - INFO -   Best loss: 0.266205
2025-08-01 00:45:10,307 - INFO -   Best similarity: 0.9096
2025-08-01 00:45:10,307 - INFO -   Steps in epoch: 1
2025-08-01 00:45:10,307 - INFO -   Epoch time: 4.3s
2025-08-01 00:45:10,308 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:45:10,308 - INFO -     Pred/CLIP ratio: 0.914 ¬± 0.305
2025-08-01 00:45:10,308 - INFO -     Deviation from ideal (1.0): 0.086
2025-08-01 00:45:10,308 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:45:10,308 - INFO - Starting epoch 8/10
2025-08-01 00:45:14,335 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:45:14,614 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:45:14,615 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:45:14,615 - INFO - Epoch 8 completed:
2025-08-01 00:45:14,615 - INFO -   Average loss: 0.262072
2025-08-01 00:45:14,615 - INFO -   Best loss: 0.262072
2025-08-01 00:45:14,615 - INFO -   Best similarity: 0.9111
2025-08-01 00:45:14,615 - INFO -   Steps in epoch: 1
2025-08-01 00:45:14,615 - INFO -   Epoch time: 4.3s
2025-08-01 00:45:14,616 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:45:14,616 - INFO -     Pred/CLIP ratio: 0.917 ¬± 0.306
2025-08-01 00:45:14,616 - INFO -     Deviation from ideal (1.0): 0.083
2025-08-01 00:45:14,616 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:45:14,616 - INFO - Starting epoch 9/10
2025-08-01 00:45:18,739 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:45:19,019 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:45:19,019 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:45:19,019 - INFO - Epoch 9 completed:
2025-08-01 00:45:19,019 - INFO -   Average loss: 0.258352
2025-08-01 00:45:19,019 - INFO -   Best loss: 0.258352
2025-08-01 00:45:19,019 - INFO -   Best similarity: 0.9123
2025-08-01 00:45:19,020 - INFO -   Steps in epoch: 1
2025-08-01 00:45:19,020 - INFO -   Epoch time: 4.4s
2025-08-01 00:45:19,020 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:45:19,020 - INFO -     Pred/CLIP ratio: 0.920 ¬± 0.308
2025-08-01 00:45:19,020 - INFO -     Deviation from ideal (1.0): 0.080
2025-08-01 00:45:19,020 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:45:19,020 - INFO - Starting epoch 10/10
2025-08-01 00:45:23,050 - INFO - Loaded shard 1/2: 2601 samples, CLIP norm=26.319, EVA norm=43.667
2025-08-01 00:45:23,330 - INFO - üéâ OVERFITTING TEST PASSED! Model can learn effectively.
2025-08-01 00:45:23,330 - INFO - üîß Scale analysis shows model is learning proper distributions.
2025-08-01 00:45:23,331 - INFO - Epoch 10 completed:
2025-08-01 00:45:23,331 - INFO -   Average loss: 0.254506
2025-08-01 00:45:23,331 - INFO -   Best loss: 0.254506
2025-08-01 00:45:23,331 - INFO -   Best similarity: 0.9135
2025-08-01 00:45:23,331 - INFO -   Steps in epoch: 1
2025-08-01 00:45:23,331 - INFO -   Epoch time: 4.3s
2025-08-01 00:45:23,331 - INFO -   üìä Epoch Scale Analysis:
2025-08-01 00:45:23,331 - INFO -     Pred/CLIP ratio: 0.923 ¬± 0.310
2025-08-01 00:45:23,331 - INFO -     Deviation from ideal (1.0): 0.077
2025-08-01 00:45:23,331 - INFO -     Scale quality: excellent (100.0% good steps)
2025-08-01 00:45:25,041 - INFO - Checkpoint saved: checkpoints/clip_repro_20250801_004223/checkpoint_step_186.pt
2025-08-01 00:45:25,042 - INFO - Running final FIXED evaluation...
2025-08-01 00:45:29,914 - INFO - Loaded shard 1/2: 2646 samples, CLIP norm=26.278, EVA norm=43.618
2025-08-01 00:45:58,490 - INFO - üîß FIXED Enhanced Scale Monitoring Training completed!
2025-08-01 00:45:58,490 - INFO -   Total time: 187.8 seconds
2025-08-01 00:45:58,490 - INFO -   Total steps: 186
2025-08-01 00:45:58,490 - INFO -   Best loss: 0.254506
2025-08-01 00:45:58,490 - INFO -   Best CLIP similarity: 0.9135
2025-08-01 00:45:58,490 - INFO -   üîß FIXED: Enhanced scale monitoring used
2025-08-01 00:45:58,490 - INFO -   üìä WandB run: False
2025-08-01 00:45:58,490 - INFO - üìä FINAL SCALE ANALYSIS:
2025-08-01 00:45:58,490 - INFO -   Pred/CLIP ratio: 0.923 ¬± 0.310
2025-08-01 00:45:58,490 - INFO -   Deviation from ideal (1.0): 0.077
2025-08-01 00:45:58,490 - INFO -   üéâ EXCELLENT scale consistency achieved!
2025-08-01 00:45:58,490 - INFO -   Scale quality: excellent
2025-08-01 00:45:58,490 - INFO -   Good scale steps: 100.0%
2025-08-01 00:45:58,490 - INFO -   CLIP norms: 25.894 ¬± 0.000
2025-08-01 00:45:58,490 - INFO -   Pred norms: 23.903 ¬± 8.018
2025-08-01 00:45:58,490 - INFO -   Final evaluation:
2025-08-01 00:45:58,490 - INFO -     CLIP similarity: 0.0080
2025-08-01 00:45:58,490 - INFO -     Generated norm: 808.714
2025-08-01 00:45:58,490 - INFO -     Target norm: 26.288
2025-08-01 00:45:58,490 - INFO -     Norm ratio: 30.764
2025-08-01 00:45:58,491 - INFO -     Scale consistency: -28.764
2025-08-01 00:45:58,491 - INFO -     Scale quality: ‚ö†Ô∏è Needs work
2025-08-01 00:45:58,491 - INFO -   Diverse overfitting test: ‚úÖ PASSED
2025-08-01 00:45:58,494 - INFO - 
==========================================================================================
2025-08-01 00:45:58,494 - INFO - üéâ FIXED SCALE MONITORING TRAINING COMPLETED!
2025-08-01 00:45:58,494 - INFO - ==========================================================================================
2025-08-01 00:45:58,494 - INFO - üìä RESULTS SUMMARY:
2025-08-01 00:45:58,494 - INFO -   Duration: 187.8 seconds (3.1 minutes)
2025-08-01 00:45:58,494 - INFO -   Total steps: 186
2025-08-01 00:45:58,494 - INFO -   Best loss: 0.254506
2025-08-01 00:45:58,494 - INFO -   Best CLIP similarity: 0.9135
2025-08-01 00:45:58,494 - INFO -   üîß FIXED version with proper noise scaling and enhanced monitoring
2025-08-01 00:45:58,494 - INFO -   üéâ EXCELLENT: Similarity >0.8 - Proper scaling worked perfectly!
2025-08-01 00:45:58,494 - INFO - üìä FINAL SCALE ANALYSIS:
2025-08-01 00:45:58,494 - INFO -   CLIP similarity: 0.0080
2025-08-01 00:45:58,494 - INFO -   Generated norm: 808.714
2025-08-01 00:45:58,494 - INFO -   Target norm: 26.288
2025-08-01 00:45:58,494 - INFO -   Norm ratio: 30.764
2025-08-01 00:45:58,494 - INFO -   Scale consistency: -28.764
2025-08-01 00:45:58,494 - INFO -   Scale quality: ‚ö†Ô∏è Needs work
2025-08-01 00:45:58,494 - INFO -   High quality (>0.7): 0.0%
2025-08-01 00:45:58,494 - INFO -   Very high quality (>0.8): 0.0%
2025-08-01 00:45:58,495 - INFO -   Excellent quality (>0.9): 0.0%
2025-08-01 00:45:58,495 - INFO -   ‚ö†Ô∏è  Scale consistency still needs work (ratio: 30.764)
2025-08-01 00:45:58,495 - INFO - üìä COMPREHENSIVE SCALE STATISTICS:
2025-08-01 00:45:58,495 - INFO -   Pred/CLIP ratios: mean=0.923, deviation=0.077
2025-08-01 00:45:58,495 - INFO -     üéâ EXCELLENT scale tracking throughout training!
2025-08-01 00:45:58,495 - INFO -   Scale quality: excellent
2025-08-01 00:45:58,495 - INFO -   Good scale steps: 100.0%
2025-08-01 00:45:58,495 - INFO -     üéâ Excellent scale consistency throughout training!
2025-08-01 00:45:58,495 - INFO - üß™ DIVERSE OVERFITTING TEST: ‚úÖ PASSED
2025-08-01 00:45:58,495 - INFO -    ‚úÖ Model can learn and memorize diverse samples effectively!
2025-08-01 00:45:58,495 - INFO -    ‚úÖ Architecture, scale handling, and data pipeline are working correctly!
2025-08-01 00:45:58,496 - INFO - üìÅ FIXED scale summary saved to checkpoints/clip_repro_20250801_004223/fixed_scale_final_summary.json
2025-08-01 00:45:58,497 - INFO - üìÅ Model checkpoints saved to checkpoints/clip_repro_20250801_004223
2025-08-01 00:45:58,497 - INFO - ==========================================================================================
2025-08-01 00:45:58,497 - INFO - üîß SCALE VERIFICATION CHECKLIST:
2025-08-01 00:45:58,497 - INFO -   ‚úÖ Noise scaling matches CLIP embedding distribution
2025-08-01 00:45:58,497 - INFO -   ‚úÖ Pred/CLIP ratio stays close to 1.0 throughout training
2025-08-01 00:45:58,497 - INFO -   ‚úÖ Enhanced scale monitoring tracks all metrics
2025-08-01 00:45:58,497 - INFO -   ‚úÖ Diverse overfitting test validates on multiple samples
2025-08-01 00:45:58,497 - INFO -   ‚úÖ Generated embeddings have proper scale relative to targets
2025-08-01 00:45:58,497 - INFO -   ‚úÖ Comprehensive scale statistics available for analysis
2025-08-01 00:45:58,497 - INFO - ==========================================================================================
2025-08-01 00:45:58,497 - INFO - üî¨ ADVANCED DEBUGGING:
2025-08-01 00:45:58,497 - INFO -   ‚Ä¢ Check WandB scale tracking plots for detailed analysis
2025-08-01 00:45:58,497 - INFO -   ‚Ä¢ Monitor 'scale/' metrics for consistency indicators
2025-08-01 00:45:58,497 - INFO -   ‚Ä¢ Look for 'Scale=‚úÖ' in training logs
2025-08-01 00:45:58,497 - INFO -   ‚Ä¢ Review embedding validation results above
2025-08-01 00:45:58,497 - INFO -   ‚Ä¢ Analyze pred/clip ratio trends over time
2025-08-01 00:45:58,497 - INFO -   ‚Ä¢ Compare noise/target ratios for scaling accuracy
2025-08-01 00:45:58,497 - INFO - ==========================================================================================
