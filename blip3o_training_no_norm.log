2025-08-04 00:44:44,860 - INFO - üöÄ BLIP3-o CLIP Reproduction Training (NO NORMALIZATION + TEMP CHECKPOINTS)
2025-08-04 00:44:44,861 - INFO - ================================================================================
2025-08-04 00:44:44,861 - INFO - üìã Task: Reproduce CLIP embeddings from EVA embeddings
2025-08-04 00:44:44,861 - INFO - üß† Model: BLIP3-o DiT WITHOUT CLIP normalization
2025-08-04 00:44:44,861 - INFO - üåä Method: Rectified Flow Matching with raw embeddings
2025-08-04 00:44:44,861 - INFO - üéØ Target: CLIP embeddings [B, N, 1024] (RAW)
2025-08-04 00:44:44,861 - INFO - üéÆ Conditioning: EVA embeddings [B, N, 4096]
2025-08-04 00:44:44,861 - INFO - üîë Focus: Training without data-dependent normalization
2025-08-04 00:44:44,861 - INFO - üì¶ NEW: Smart checkpoint management with temp directory support
2025-08-04 00:44:44,861 - INFO - ================================================================================
2025-08-04 00:44:44,861 - INFO - üõ†Ô∏è KEY CHANGES:
2025-08-04 00:44:44,861 - INFO -    ‚úÖ 1. No CLIP normalization/denormalization
2025-08-04 00:44:44,861 - INFO -    ‚úÖ 2. Work directly with raw CLIP embeddings
2025-08-04 00:44:44,861 - INFO -    ‚úÖ 3. No dependency on training data statistics
2025-08-04 00:44:44,861 - INFO -    ‚úÖ 4. Simplified training and evaluation pipeline
2025-08-04 00:44:44,861 - INFO -    ‚úÖ 5. Optional simple data-independent scaling
2025-08-04 00:44:44,861 - INFO -    üÜï 6. Intelligent checkpoint management for large-scale training
2025-08-04 00:44:44,862 - INFO -    üÜï 7. Automatic temp directory detection
2025-08-04 00:44:44,862 - INFO - ================================================================================
2025-08-04 00:44:44,864 - INFO - Found 35 embedding files
2025-08-04 00:44:44,864 - WARNING - ‚ö†Ô∏è Large batch size (128) may cause memory issues
2025-08-04 00:44:44,864 - INFO - ‚úÖ Local checkpoint directory: checkpoints/blip3o_no_norm_20250804_004443
2025-08-04 00:44:44,865 - INFO - üîç Auto-detected temp directory: /scratch-shared/azadaianchuk1/blip3o_workspace/checkpoints
2025-08-04 00:44:44,881 - INFO - ‚úÖ Temp checkpoint directory ready: /scratch-shared/azadaianchuk1/blip3o_workspace/checkpoints
2025-08-04 00:44:44,881 - INFO - Configuration (NO NORMALIZATION + TEMP CHECKPOINTS):
2025-08-04 00:44:44,881 - INFO -   Model size: base
2025-08-04 00:44:44,881 - INFO -   Training mode: patch_only
2025-08-04 00:44:44,881 - INFO -   Embeddings dir: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-04 00:44:44,881 - INFO -   Output dir: checkpoints/blip3o_no_norm_20250804_004443
2025-08-04 00:44:44,881 - INFO -   Temp checkpoint dir: /scratch-shared/azadaianchuk1/blip3o_workspace/checkpoints
2025-08-04 00:44:44,881 - INFO -   Keep local checkpoints: 3
2025-08-04 00:44:44,881 - INFO -   Save to temp every: 1000 steps
2025-08-04 00:44:44,881 - INFO -   Learning rate: 4e-05
2025-08-04 00:44:44,881 - INFO -   Batch size: 128
2025-08-04 00:44:44,881 - INFO -   Epochs: 10
2025-08-04 00:44:44,881 - INFO -   Max shards: 35
2025-08-04 00:44:44,881 - INFO -   Simple scale factor: 1.0
2025-08-04 00:44:44,881 - INFO -   Loss weights:
2025-08-04 00:44:44,881 - INFO -     Velocity: 1.0
2025-08-04 00:44:44,881 - INFO -     Semantic: 0.5
2025-08-04 00:44:44,881 - INFO -     Cosine: 0.2
2025-08-04 00:44:44,881 - INFO -     Consistency: 0.3
2025-08-04 00:44:44,881 - INFO -   EVA adapter: ‚úÖ ENABLED
2025-08-04 00:44:44,881 - INFO -   Heun inference: ‚úÖ ENABLED
2025-08-04 00:44:44,881 - INFO -   Normalization: DISABLED
2025-08-04 00:44:45,147 - INFO - Using GPU: NVIDIA H100
2025-08-04 00:44:45,147 - INFO - GPU Memory: 100.0 GB
2025-08-04 00:44:45,147 - INFO - PyTorch version: 2.7.1+cu126
2025-08-04 00:44:47,848 - INFO - ‚úÖ CLIP DiT model loaded successfully
2025-08-04 00:44:47,849 - INFO - ‚úÖ Flow matching loss loaded successfully
2025-08-04 00:44:48,571 - INFO - ‚úÖ CLIP trainer loaded successfully
2025-08-04 00:44:48,573 - INFO - ‚úÖ CLIP datasets loaded successfully
2025-08-04 00:44:48,575 - INFO - ‚úÖ Configuration loaded successfully
2025-08-04 00:44:48,575 - INFO - üéâ All CLIP reproduction components loaded successfully!
2025-08-04 00:44:48,575 - INFO - üéâ Clean BLIP3-o CLIP reproduction modules fully initialized!
2025-08-04 00:44:48,575 - INFO - üéØ Ready for EVA ‚Üí CLIP reproduction training
2025-08-04 00:44:48,575 - INFO - ‚úÖ Dataset module loaded (NO NORMALIZATION)
2025-08-04 00:44:48,575 - INFO - ‚úÖ Model module loaded
2025-08-04 00:44:48,575 - INFO - ‚úÖ Loss module loaded (NO NORMALIZATION)
2025-08-04 00:44:48,575 - INFO - ‚úÖ Trainer module loaded (NO NORMALIZATION)
2025-08-04 00:44:48,575 - INFO - ‚úÖ All required modules loaded successfully
2025-08-04 00:44:48,575 - INFO - ‚úÖ Environment check passed
2025-08-04 00:44:48,575 - INFO - üèóÔ∏è Creating model...
2025-08-04 00:44:48,575 - INFO - ‚úÖ Configuration validation passed
2025-08-04 00:44:49,004 - INFO - ‚úÖ EVA-CLIP Adapter initialized: 4096 ‚Üí 768
2025-08-04 00:44:49,004 - INFO -    Layers: 6, Dropout: 0.1, Residual: True
2025-08-04 00:44:50,448 - INFO - ‚úÖ Stable initialization applied with depth scale: 0.2887
2025-08-04 00:44:50,450 - INFO - ‚úÖ IMPROVED BLIP3-o CLIP DiT model initialized: 227,474,014 parameters
2025-08-04 00:44:50,450 - INFO -   üî• EVA adapter: ENABLED
2025-08-04 00:44:50,450 - INFO -   üöÄ Heun solver: ENABLED
2025-08-04 00:44:50,450 - INFO -   ‚ö° Attention caching: Available
2025-08-04 00:44:50,450 - INFO - ‚úÖ IMPROVED BLIP3-o model created:
2025-08-04 00:44:50,450 - INFO -    Size: base
2025-08-04 00:44:50,451 - INFO -    Parameters: 227,474,014
2025-08-04 00:44:50,451 - INFO -    EVA adapter: ‚úÖ
2025-08-04 00:44:50,451 - INFO -    Heun solver: ‚úÖ
2025-08-04 00:44:50,451 - INFO -    3D RoPE: ‚úÖ
2025-08-04 00:44:50,451 - INFO -    Sandwich norm: ‚úÖ
2025-08-04 00:44:50,672 - INFO - ‚úÖ Model created with 227,474,014 parameters
2025-08-04 00:44:50,672 - INFO -   Model size: base
2025-08-04 00:44:50,672 - INFO -   Training mode: patch_only
2025-08-04 00:44:50,672 - INFO -   3D RoPE: ‚úÖ ENABLED
2025-08-04 00:44:50,672 - INFO -   Sandwich Norm: ‚úÖ ENABLED
2025-08-04 00:44:50,672 - INFO -   EVA Adapter: ‚úÖ ENABLED
2025-08-04 00:44:50,672 - INFO -   Heun Solver: ‚úÖ ENABLED
2025-08-04 00:44:50,672 - INFO - üåä Creating loss function...
2025-08-04 00:44:50,672 - INFO - ‚úÖ Flow Matching Loss initialized (NO NORMALIZATION):
2025-08-04 00:44:50,672 - INFO -   Prediction type: velocity
2025-08-04 00:44:50,672 - INFO -   Flow type: rectified
2025-08-04 00:44:50,672 - INFO -   Weights - Velocity: 1.0, Semantic: 0.5, Cosine: 0.2
2025-08-04 00:44:50,672 - INFO -   Consistency weight: 0.3
2025-08-04 00:44:50,672 - INFO -   Normalization: DISABLED
2025-08-04 00:44:50,672 - INFO - ‚úÖ Loss function created (NO NORMALIZATION):
2025-08-04 00:44:50,672 - INFO -   Prediction type: velocity
2025-08-04 00:44:50,672 - INFO -   Flow type: rectified
2025-08-04 00:44:50,672 - INFO -   Weights - Velocity: 1.0, Semantic: 0.5, Cosine: 0.2
2025-08-04 00:44:50,672 - INFO -   Consistency weight: 0.3
2025-08-04 00:44:50,672 - INFO -   Timestep weighting: ‚úÖ ENABLED
2025-08-04 00:44:50,672 - INFO -   Normalization: DISABLED
2025-08-04 00:44:50,672 - INFO - üìä Creating dataloaders (NO NORMALIZATION)...
2025-08-04 00:44:50,673 - INFO - Loading embeddings from: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-04 00:44:50,673 - INFO - Found 35 .pkl files in embeddings directory
2025-08-04 00:44:50,673 - INFO - Creating CLIP reproduction dataloaders (NO NORMALIZATION):
2025-08-04 00:44:50,673 - INFO -   Target: CLIP embeddings [B, N, 1024] (RAW)
2025-08-04 00:44:50,673 - INFO -   Conditioning: EVA embeddings [B, N, 4096]
2025-08-04 00:44:50,673 - INFO -   Simple scale factor: 1.0
2025-08-04 00:44:50,673 - INFO -   Timestep sampling: U-shaped distribution
2025-08-04 00:44:50,673 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-04 00:44:50,674 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-04 00:44:50,674 - INFO - Prepared 35 shard files
2025-08-04 00:44:50,674 - INFO - Using manifest for length estimation: 91,333 samples
2025-08-04 00:44:50,674 - INFO - BLIP3-o CLIP Reproduction Dataset initialized (NO NORMALIZATION):
2025-08-04 00:44:50,674 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-04 00:44:50,674 - INFO -   Mode: patch_only (256 tokens)
2025-08-04 00:44:50,674 - INFO -   TARGET: CLIP embeddings [B, N, 1024] (RAW - NO NORMALIZATION)
2025-08-04 00:44:50,674 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096]
2025-08-04 00:44:50,674 - INFO -   Shards: 35
2025-08-04 00:44:50,674 - INFO -   Simple scale factor: 1.0
2025-08-04 00:44:50,674 - INFO -   ‚úÖ CLIP normalization: DISABLED
2025-08-04 00:44:50,675 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-04 00:44:50,675 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-04 00:44:50,675 - INFO - Prepared 35 shard files
2025-08-04 00:44:50,675 - INFO - Using manifest for length estimation: 91,333 samples
2025-08-04 00:44:50,675 - INFO - BLIP3-o CLIP Reproduction Dataset initialized (NO NORMALIZATION):
2025-08-04 00:44:50,675 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-04 00:44:50,675 - INFO -   Mode: patch_only (256 tokens)
2025-08-04 00:44:50,675 - INFO -   TARGET: CLIP embeddings [B, N, 1024] (RAW - NO NORMALIZATION)
2025-08-04 00:44:50,675 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096]
2025-08-04 00:44:50,675 - INFO -   Shards: 35
2025-08-04 00:44:50,675 - INFO -   Simple scale factor: 1.0
2025-08-04 00:44:50,676 - INFO -   ‚úÖ CLIP normalization: DISABLED
2025-08-04 00:44:50,676 - INFO - ‚úÖ CLIP reproduction dataloaders created (NO NORMALIZATION)
2025-08-04 00:44:50,676 - INFO -   Training dataset length: 91,333
2025-08-04 00:44:50,676 - INFO -   Evaluation dataset length: 91,333
2025-08-04 00:44:50,676 - INFO -   üî• CLIP normalization: DISABLED
2025-08-04 00:44:50,676 - INFO - ‚úÖ Dataloaders created successfully (NO NORMALIZATION):
2025-08-04 00:44:50,676 - INFO -   Training mode: patch_only
2025-08-04 00:44:50,676 - INFO -   Batch size: 128
2025-08-04 00:44:50,676 - INFO -   Max shards: 35
2025-08-04 00:44:50,676 - INFO -   Simple scale factor: 1.0
2025-08-04 00:44:50,676 - INFO -   CLIP normalization: DISABLED
2025-08-04 00:44:55,350 - INFO - ‚úÖ Dataloader test successful:
2025-08-04 00:44:55,353 - INFO -   Batch size: 128
2025-08-04 00:44:55,353 - INFO -   CLIP embeddings shape: torch.Size([128, 256, 1024])
2025-08-04 00:44:55,353 - INFO -   EVA embeddings shape: torch.Size([128, 256, 4096])
2025-08-04 00:44:55,355 - INFO -   Raw CLIP range: [-37.062, 223.375]
2025-08-04 00:44:55,355 - INFO - üèÉ Creating trainer...
2025-08-04 00:44:55,355 - INFO - üóÇÔ∏è Temp checkpoint directory: /scratch-shared/azadaianchuk1/blip3o_workspace/checkpoints
2025-08-04 00:44:55,359 - INFO - Got exact dataloader length: 713
2025-08-04 00:44:55,360 - INFO - ‚úÖ Conservative optimizer setup complete
2025-08-04 00:44:55,360 - INFO - ‚úÖ Mixed precision enabled
2025-08-04 00:44:55,360 - INFO - ‚úÖ BLIP3-o Trainer initialized (NO NORMALIZATION)
2025-08-04 00:44:55,360 - INFO -   Device: cuda
2025-08-04 00:44:55,361 - INFO -   Parameters: 227,474,014
2025-08-04 00:44:55,361 - INFO -   CLIP normalization: DISABLED
2025-08-04 00:44:55,361 - INFO -   Enhanced stability features: enabled
2025-08-04 00:44:55,361 - INFO -   Checkpoint strategy: Local + Temp
2025-08-04 00:44:55,361 - INFO - ‚úÖ Trainer created successfully (NO NORMALIZATION + TEMP CHECKPOINTS):
2025-08-04 00:44:55,361 - INFO -   Evaluation: Every 500 steps
2025-08-04 00:44:55,361 - INFO -   WandB enabled: False
2025-08-04 00:44:55,361 - INFO -   Heun inference: ‚úÖ ENABLED
2025-08-04 00:44:55,362 - INFO -   Normalization: DISABLED
2025-08-04 00:44:55,362 - INFO -   Local checkpoints: 3
2025-08-04 00:44:55,362 - INFO -   Temp checkpoints: ‚úÖ ENABLED
2025-08-04 00:44:55,362 - INFO -   Temp directory: /scratch-shared/azadaianchuk1/blip3o_workspace/checkpoints
2025-08-04 00:44:55,362 - INFO -   Save to temp every: 1000 steps
2025-08-04 00:44:55,362 - INFO - üíæ Saving experiment configuration...
2025-08-04 00:44:55,364 - INFO - ‚úÖ Configuration saved to checkpoints/blip3o_no_norm_20250804_004443/experiment_config.json
2025-08-04 00:44:55,396 - INFO - ‚úÖ Configuration also saved to temp: /scratch-shared/azadaianchuk1/blip3o_workspace/checkpoints/experiment_config.json
2025-08-04 00:44:55,396 - INFO - 
üöÄ Starting BLIP3-o training (NO NORMALIZATION + TEMP CHECKPOINTS)...
2025-08-04 00:44:55,396 - INFO - ================================================================================
2025-08-04 00:44:55,396 - INFO - üéØ Expected Results:
2025-08-04 00:44:55,397 - INFO -    ‚Ä¢ Simplified training without normalization concerns
2025-08-04 00:44:55,397 - INFO -    ‚Ä¢ Direct work with original CLIP embedding space
2025-08-04 00:44:55,397 - INFO -    ‚Ä¢ No dependency on training data statistics
2025-08-04 00:44:55,397 - INFO -    ‚Ä¢ Easier debugging and evaluation
2025-08-04 00:44:55,397 - INFO -    ‚Ä¢ Smart checkpoint management for large-scale training
2025-08-04 00:44:55,397 - INFO -    ‚Ä¢ Checkpoints saved to temp: /scratch-shared/azadaianchuk1/blip3o_workspace/checkpoints
2025-08-04 00:44:55,397 - INFO - ================================================================================
2025-08-04 00:44:55,397 - INFO - üöÄ Starting BLIP3-o training (NO NORMALIZATION)...
2025-08-04 00:44:55,397 - INFO -   Enhanced stability monitoring active
2025-08-04 00:44:55,397 - INFO -   WandB logging: ‚ùå DISABLED
2025-08-04 00:44:55,397 - INFO -   Checkpoint strategy: Local + Temp
2025-08-04 00:44:55,397 - INFO -   Temp directory: /scratch-shared/azadaianchuk1/blip3o_workspace/checkpoints
2025-08-04 00:44:55,397 - INFO -   Save to temp every: 1000 steps
2025-08-04 00:44:55,397 - INFO -   Keep local checkpoints: 3
2025-08-04 00:44:55,399 - INFO - Starting epoch 1/10
2025-08-04 00:45:09,534 - INFO - Step 10: Loss=1.925711, GradNorm=49291.954, Failures=0
2025-08-04 00:45:10,500 - WARNING - ‚ö†Ô∏è High gradients detected, using stricter clipping: 0.500
2025-08-04 00:45:11,482 - WARNING - ‚ö†Ô∏è High gradients detected, using stricter clipping: 0.500
2025-08-04 00:45:12,463 - WARNING - ‚ö†Ô∏è High gradients detected, using stricter clipping: 0.500
2025-08-04 00:45:13,446 - WARNING - ‚ö†Ô∏è High gradients detected, using stricter clipping: 0.500
