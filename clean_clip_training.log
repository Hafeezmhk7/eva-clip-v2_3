2025-08-01 19:49:38,327 - INFO - üöÄ Clean BLIP3-o CLIP Reproduction Training
2025-08-01 19:49:38,328 - INFO - ============================================================
2025-08-01 19:49:38,328 - INFO - üìã Task: Reproduce CLIP embeddings from EVA embeddings
2025-08-01 19:49:38,328 - INFO - üß† Model: BLIP3-o DiT with 3D RoPE and Sandwich Normalization
2025-08-01 19:49:38,328 - INFO - üåä Method: Rectified Flow Matching
2025-08-01 19:49:38,328 - INFO - üéØ Target: CLIP embeddings [B, N, 1024]
2025-08-01 19:49:38,328 - INFO - üéÆ Conditioning: EVA embeddings [B, N, 4096]
2025-08-01 19:49:38,328 - INFO - ============================================================
2025-08-01 19:49:38,329 - INFO - Configuration:
2025-08-01 19:49:38,329 - INFO -   Model size: base
2025-08-01 19:49:38,329 - INFO -   Training mode: patch_only
2025-08-01 19:49:38,329 - INFO -   Embeddings dir: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 19:49:38,329 - INFO -   Output dir: ./checkpoints/blip3o_clean_20250801_194935
2025-08-01 19:49:38,330 - INFO -   Learning rate: 0.0001
2025-08-01 19:49:38,330 - INFO -   Batch size: 8
2025-08-01 19:49:38,330 - INFO -   Epochs: 10
2025-08-01 19:49:38,330 - INFO -   Max shards: 5
2025-08-01 19:49:38,807 - INFO - Using GPU: NVIDIA H100
2025-08-01 19:49:38,807 - INFO - GPU Memory: 100.0 GB
2025-08-01 19:49:38,807 - INFO - PyTorch version: 2.7.1+cu126
2025-08-01 19:49:38,807 - INFO - ‚úÖ Environment check passed
2025-08-01 19:49:38,807 - INFO - ‚úÖ Output directory ready: checkpoints/blip3o_clean_20250801_194935
2025-08-01 19:49:38,807 - INFO - üèóÔ∏è Creating model...
2025-08-01 19:49:44,206 - INFO - ‚úÖ CLIP DiT model loaded successfully
2025-08-01 19:49:44,219 - INFO - ‚úÖ Flow matching loss loaded successfully
2025-08-01 19:49:45,433 - INFO - ‚úÖ CLIP trainer loaded successfully
2025-08-01 19:49:45,444 - INFO - ‚úÖ CLIP datasets loaded successfully
2025-08-01 19:49:45,455 - INFO - ‚úÖ Configuration loaded successfully
2025-08-01 19:49:45,455 - INFO - üéâ All CLIP reproduction components loaded successfully!
2025-08-01 19:49:45,455 - INFO - üéâ Clean BLIP3-o CLIP reproduction modules fully initialized!
2025-08-01 19:49:45,455 - INFO - üéØ Ready for EVA ‚Üí CLIP reproduction training
2025-08-01 19:49:47,472 - INFO - BLIP3-o CLIP DiT model initialized with 249,339,136 parameters
2025-08-01 19:49:47,700 - INFO - Model created with 249,339,136 parameters
2025-08-01 19:49:47,700 - INFO -   Model size: base
2025-08-01 19:49:47,700 - INFO -   Training mode: patch_only
2025-08-01 19:49:47,700 - INFO -   3D RoPE: Enabled
2025-08-01 19:49:47,700 - INFO -   Sandwich Norm: Enabled
2025-08-01 19:49:47,700 - INFO - üåä Creating loss function...
2025-08-01 19:49:47,700 - INFO - Clean CLIP Flow Matching Loss initialized:
2025-08-01 19:49:47,700 - INFO -   Prediction type: velocity
2025-08-01 19:49:47,700 - INFO -   Flow type: rectified
2025-08-01 19:49:47,700 - INFO - Loss function created:
2025-08-01 19:49:47,700 - INFO -   Prediction type: velocity
2025-08-01 19:49:47,700 - INFO -   Flow type: rectified
2025-08-01 19:49:47,700 - INFO - üìä Creating dataloaders...
2025-08-01 19:49:47,700 - INFO - Loading embeddings from: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 19:49:47,701 - INFO - Found 35 .pkl files in embeddings directory
2025-08-01 19:49:47,701 - INFO - Creating clean CLIP reproduction dataloaders:
2025-08-01 19:49:47,701 - INFO -   Target: CLIP embeddings [B, N, 1024]
2025-08-01 19:49:47,701 - INFO -   Conditioning: EVA embeddings [B, N, 4096]
2025-08-01 19:49:47,701 - INFO -   Noise: Standard Gaussian
2025-08-01 19:49:47,731 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-01 19:49:47,731 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-01 19:49:47,753 - INFO - Prepared 5 shard files
2025-08-01 19:49:47,754 - INFO - Using manifest for length estimation: 13,047 samples
2025-08-01 19:49:47,754 - INFO - Clean CLIP Reproduction Dataset initialized:
2025-08-01 19:49:47,754 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 19:49:47,754 - INFO -   Mode: patch_only (256 tokens)
2025-08-01 19:49:47,754 - INFO -   TARGET: CLIP embeddings [B, N, 1024]
2025-08-01 19:49:47,754 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096]
2025-08-01 19:49:47,754 - INFO -   Shards: 5
2025-08-01 19:49:47,754 - INFO - Loaded manifest: 35 shards, 91,333 samples
2025-08-01 19:49:47,755 - INFO - Found 35 files with pattern: embeddings_shard_*_patch_only.pkl
2025-08-01 19:49:47,755 - INFO - Prepared 5 shard files
2025-08-01 19:49:47,755 - INFO - Using manifest for length estimation: 13,047 samples
2025-08-01 19:49:47,755 - INFO - Clean CLIP Reproduction Dataset initialized:
2025-08-01 19:49:47,755 - INFO -   Directory: /scratch-shared/azadaianchuk1/blip3o_workspace/embeddings/patch_only_256_tokens
2025-08-01 19:49:47,755 - INFO -   Mode: patch_only (256 tokens)
2025-08-01 19:49:47,755 - INFO -   TARGET: CLIP embeddings [B, N, 1024]
2025-08-01 19:49:47,755 - INFO -   CONDITIONING: EVA embeddings [B, N, 4096]
2025-08-01 19:49:47,755 - INFO -   Shards: 5
2025-08-01 19:49:47,755 - INFO - Clean CLIP reproduction dataloaders created successfully
2025-08-01 19:49:47,755 - INFO -   Training dataset length: 13,047
2025-08-01 19:49:47,755 - INFO -   Evaluation dataset length: 13,047
2025-08-01 19:49:47,755 - INFO - Dataloaders created successfully:
2025-08-01 19:49:47,755 - INFO -   Training mode: patch_only
2025-08-01 19:49:47,755 - INFO -   Batch size: 8
2025-08-01 19:49:47,755 - INFO -   Max shards: 5
2025-08-01 19:49:52,116 - INFO - ‚úÖ Dataloader test successful:
2025-08-01 19:49:52,116 - INFO -   Batch size: 8
2025-08-01 19:49:52,116 - INFO -   CLIP embeddings shape: torch.Size([8, 256, 1024])
2025-08-01 19:49:52,116 - INFO -   EVA embeddings shape: torch.Size([8, 256, 4096])
2025-08-01 19:49:52,116 - INFO - üèÉ Creating trainer...
2025-08-01 19:49:52,119 - INFO - Got exact dataloader length: 1630
2025-08-01 19:49:52,121 - INFO - Optimizer and scheduler setup complete
2025-08-01 19:49:52,121 - INFO -   Total estimated steps: 16300
2025-08-01 19:49:52,121 - INFO -   Warmup steps: 100
2025-08-01 19:49:52,121 - INFO - Clean BLIP3-o CLIP Trainer initialized
2025-08-01 19:49:52,121 - INFO -   Device: cuda
2025-08-01 19:49:52,122 - INFO -   Parameters: 249,339,136
2025-08-01 19:49:52,122 - INFO - Trainer created successfully:
2025-08-01 19:49:52,122 - INFO -   Evaluation: Every 50 steps
2025-08-01 19:49:52,122 - INFO -   WandB enabled: False
2025-08-01 19:49:52,122 - INFO - üíæ Saving experiment configuration...
2025-08-01 19:49:52,124 - INFO - ‚úÖ Configuration saved to checkpoints/blip3o_clean_20250801_194935/experiment_config.json
2025-08-01 19:49:52,125 - INFO - 
üöÄ Starting clean BLIP3-o training...
2025-08-01 19:49:52,125 - INFO - ============================================================
2025-08-01 19:49:52,125 - INFO - üöÄ Starting clean BLIP3-o training...
2025-08-01 19:49:52,125 - INFO -   Model parameters: 249,339,136
2025-08-01 19:49:52,127 - INFO - Starting epoch 1/10
2025-08-01 19:49:59,448 - INFO - Step 10: Loss=1.847589, VelSim=0.2340, GradNorm=53742.029, LR=1.90e-05
2025-08-01 19:50:02,171 - INFO - Step 20: Loss=1.741470, VelSim=0.3008, GradNorm=28498.728, LR=2.80e-05
2025-08-01 19:50:04,898 - INFO - Step 30: Loss=1.683507, VelSim=0.3417, GradNorm=21218.634, LR=3.70e-05
2025-08-01 19:50:07,624 - INFO - Step 40: Loss=1.672143, VelSim=0.3569, GradNorm=23504.330, LR=4.60e-05
2025-08-01 19:50:10,350 - INFO - Step 50: Loss=1.601034, VelSim=0.3369, GradNorm=26374.742, LR=5.50e-05
2025-08-01 19:50:10,354 - INFO - Running evaluation at step 50...
2025-08-01 19:50:10,354 - INFO - Starting evaluation with 100 samples
2025-08-01 19:51:48,846 - INFO - ‚úÖ Evaluation completed: 104 samples, similarity: 0.2417
2025-08-01 19:51:48,848 - INFO - ‚úÖ Evaluation results:
2025-08-01 19:51:48,848 - INFO -   CLIP similarity: 0.2417
2025-08-01 19:51:51,583 - INFO - Step 60: Loss=1.638397, VelSim=0.3513, GradNorm=36756.611, LR=6.40e-05
2025-08-01 19:51:54,313 - INFO - Step 70: Loss=1.651710, VelSim=0.3646, GradNorm=29366.970, LR=7.30e-05
2025-08-01 19:51:57,043 - INFO - Step 80: Loss=1.608418, VelSim=0.3483, GradNorm=37059.518, LR=8.20e-05
2025-08-01 19:51:59,774 - INFO - Step 90: Loss=1.533234, VelSim=0.3871, GradNorm=49840.964, LR=9.10e-05
2025-08-01 19:52:02,505 - INFO - Step 100: Loss=1.549105, VelSim=0.3577, GradNorm=50212.216, LR=1.00e-04
2025-08-01 19:52:02,505 - INFO - Running evaluation at step 100...
2025-08-01 19:52:02,505 - INFO - Starting evaluation with 100 samples
2025-08-01 19:53:40,361 - INFO - ‚úÖ Evaluation completed: 104 samples, similarity: 0.2141
2025-08-01 19:53:40,364 - INFO - ‚úÖ Evaluation results:
2025-08-01 19:53:40,364 - INFO -   CLIP similarity: 0.2141
2025-08-01 19:53:43,100 - INFO - Step 110: Loss=1.454791, VelSim=0.3532, GradNorm=59058.732, LR=1.00e-04
2025-08-01 19:53:45,830 - INFO - Step 120: Loss=1.435449, VelSim=0.3551, GradNorm=71470.952, LR=1.00e-04
2025-08-01 19:53:48,563 - INFO - Step 130: Loss=1.408117, VelSim=0.3691, GradNorm=43104.326, LR=1.00e-04
